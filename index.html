<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>MOLI game company</title>
    <style>
        /* 样式保持不变 */
        * {
            font-family: Consolas, "Courier New", monospace;
            margin: 0;
            padding: 0;
        }

        .uid-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #444444;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 100;
            border: 1px solid #666666;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
        }

        /* 其他样式保持不变... */
        
    </style>
</head>
<body>
    <!-- 右上角UID显示框 -->
    <div class="uid-display" id="uidDisplay">
        UID: <span id="currentUID">未登录</span>
    </div>

     <button style="z-index:-1;background-color:#0f0f30;position:fixed;top:0;bottom:0;left:0;right:0;"></button>

    <div class="container">
        <h1>MOLI game company onlined</h1>
        
        <div class="buttons-container">
            <button class="basic btn-blu" onclick="gotoluogu()">main page (luogu team)</button>
            <button class="basic btn-red" onclick="newpost()">new post</button>
            <button class="basic btn-gre" onclick="gotodomain()" id="gotodomain">go to domain</button>
            <button class="basic btn-yel" onclick="showlogin()" id="lshower">log in</button>
        </div>
    </div>

    <script>
        var logined = 0;
        var usersbeok = [1802886, 1384733, 1581608];
        var UID = 0;
        var token = localStorage.getItem('userToken');

        // 页面加载时检查登录状态并显示UID
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
        });

        // 检查登录状态并更新UID显示
        function checkLoginStatus() {
            if (token) {
                // 检查token是否有效（不是错误消息）
                const errorMessages = ["Incorrect ID or password", "UID not authorized"];
                const isError = errorMessages.some(msg => token.includes(msg));
                
                if (!isError) {
                    fetch('/auth/uid', {
                        headers: {'Authorization': `Bearer ${token}`}
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.text();
                        } else {
                            localStorage.removeItem('userToken');
                            token = null;
                            return null;
                        }
                    })
                    .then(uid => {
                        if (uid) {
                            // 检查返回的uid是否也是错误消息
                            const uidError = errorMessages.some(msg => uid.includes(msg));
                            if (!uidError) {
                                updateUIDDisplay(uid);
                                logined = 1;
                                document.getElementById('lshower').textContent = 'log out';
                                document.getElementById('lshower').onclick = logout;
                            } else {
                                resetUIDDisplay();
                            }
                        } else {
                            resetUIDDisplay();
                        }
                    })
                    .catch(error => {
                        console.error('检查登录状态失败:', error);
                        resetUIDDisplay();
                    });
                } else {
                    // token本身就是错误消息，清除它
                    localStorage.removeItem('userToken');
                    token = null;
                    resetUIDDisplay();
                }
            } else {
                resetUIDDisplay();
            }
        }

        // 更新UID显示
        function updateUIDDisplay(uid) {
            document.getElementById('uidDisplay').style.display = 'block';
            document.getElementById('currentUID').textContent = uid;
            UID = uid;
        }

        // 重置UID显示（未登录状态）
        function resetUIDDisplay() {
            document.getElementById('uidDisplay').style.display = 'none';
            document.getElementById('currentUID').textContent = '未登录';
            UID = 0;
            logined = 0;
            document.getElementById('lshower').textContent = 'log in';
            document.getElementById('lshower').onclick = showlogin;
        }

        // 注销函数
        function logout() {
            localStorage.removeItem('userToken');
            token = null;
            resetUIDDisplay();
            alert('已注销');
        }

        // 修改登录逻辑：存储token并更新显示
        function handleLoginSuccess(uid) {
            // 检查uid是否有效
            const errorMessages = ["Incorrect ID or password", "UID not authorized"];
            const isError = errorMessages.some(msg => uid.includes(msg));
            
            if (!isError) {
                localStorage.setItem('userToken', uid);
                token = uid;
                updateUIDDisplay(uid);
                logined = 1;
                document.getElementById('lshower').textContent = 'log out';
                document.getElementById('lshower').onclick = logout;
                alert('登录成功！当前用户: ' + uid);
            }
        }

        // 原函数保持不变
        function gotoluogu() {
            window.location.href = "https://luogu.com.cn/team/94555";
        }
        
        function newpost() {
            alert('loading');
        }
        
        function gotodomain() {
            if (UID) {
                alert('跳转到用户域: ' + UID);
            } else {
                alert('请先登录');
            }
        }
        
        function showlogin() {
            window.location.href = "/auth/login";
        }
    </script>
</body>
</html>
